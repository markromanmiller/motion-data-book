<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>motion-data-book - 2&nbsp; MYREC File Format</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./bids.html" rel="next">
<link href="./dddr.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./myrec.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">MYREC File Format</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">motion-data-book</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dddr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title"><code>dddr</code>: Three-Dimensional Vector Operations in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./myrec.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">MYREC File Format</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bids.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">BIDS (Brain Imaging Data Structure)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./converting-myrec-bids.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Converting MYREC to BIDS</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Examples of Social Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#file-structure" id="toc-file-structure" class="nav-link active" data-scroll-target="#file-structure"><span class="header-section-number">2.1</span> File structure</a></li>
  <li><a href="#file-contents" id="toc-file-contents" class="nav-link" data-scroll-target="#file-contents"><span class="header-section-number">2.2</span> File Contents</a>
  <ul class="collapse">
  <li><a href="#count.txt" id="toc-count.txt" class="nav-link" data-scroll-target="#count.txt"><span class="header-section-number">2.2.1</span> count.txt</a></li>
  <li><a href="#master.txt" id="toc-master.txt" class="nav-link" data-scroll-target="#master.txt"><span class="header-section-number">2.2.2</span> master.txt</a></li>
  <li><a href="#audioothers.mp3" id="toc-audioothers.mp3" class="nav-link" data-scroll-target="#audioothers.mp3"><span class="header-section-number">2.2.3</span> audioothers.mp3</a></li>
  <li><a href="#events.txt" id="toc-events.txt" class="nav-link" data-scroll-target="#events.txt"><span class="header-section-number">2.2.4</span> events.txt</a></li>
  <li><a href="#stream.txt" id="toc-stream.txt" class="nav-link" data-scroll-target="#stream.txt"><span class="header-section-number">2.2.5</span> stream.txt</a></li>
  </ul></li>
  <li><a href="#interpretations" id="toc-interpretations" class="nav-link" data-scroll-target="#interpretations"><span class="header-section-number">2.3</span> Interpretations</a>
  <ul class="collapse">
  <li><a href="#root-head-hands-physical-virtual-and-visible-motion" id="toc-root-head-hands-physical-virtual-and-visible-motion" class="nav-link" data-scroll-target="#root-head-hands-physical-virtual-and-visible-motion"><span class="header-section-number">2.3.1</span> Root, Head, Hands / Physical, Virtual, and Visible Motion</a></li>
  <li><a href="#others" id="toc-others" class="nav-link" data-scroll-target="#others"><span class="header-section-number">2.3.2</span> others…</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">MYREC File Format</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>The .myrec file format is a proprietary, undocumented, and unsupported VR recording format from ENGAGE. In it contains everything that the ENGAGE client needs to re-render a recording. Fortunately for those who study human behavior, this recording contains quite a view streams of data in high temporal fidelity. The recording includes position and rotation data for each participant, as well as IFX interactions, avatar choices, audio, and button events.</p>
<section id="file-structure" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="file-structure"><span class="header-section-number">2.1</span> File structure</h2>
<p>The .myrec file is a ZIP file archive that contains several compressed files within it. This file structure is consistent across all .myrec files that I’ve encountered from June to December 2021. Once unzipped recursively, the file structure is:</p>
<ul>
<li><code>count.txt</code></li>
<li><code>master</code> (ZIP)
<ul>
<li><code>master.txt</code></li>
</ul></li>
<li><code>stream0</code> (ZIP)
<ul>
<li><code>audioothers.mp3</code></li>
<li><code>events.txt</code></li>
<li><code>stream.txt</code></li>
</ul></li>
<li><code>stream1</code> (ZIP)</li>
<li>…</li>
</ul>
<p>Each file is described below.</p>
</section>
<section id="file-contents" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="file-contents"><span class="header-section-number">2.2</span> File Contents</h2>
<section id="count.txt" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="count.txt"><span class="header-section-number">2.2.1</span> count.txt</h3>
<p>This file is a one-line file in what appears to be key-value pairs. Pairs are separated by a semicolon, and keys and values are separated by a pipe.</p>
<ul>
<li><code>streamCount</code>: the number of <code>streamN</code> archives in the top-level archive, where <code>N</code> is a non-negative integer.</li>
<li><code>sceneID</code>: the environment in which the recording takes place.</li>
</ul>
</section>
<section id="master.txt" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="master.txt"><span class="header-section-number">2.2.2</span> master.txt</h3>
<p>This file gives information about the recording as a whole. For example, there is some information about the timing of the different <code>streamN</code> files. Information about the recorder’s and participants’ avatars is also stored here. While its file suffix is <code>.txt</code>, it is in fact a JSON file. There are too many entries to be described here.</p>
</section>
<section id="audioothers.mp3" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="audioothers.mp3"><span class="header-section-number">2.2.3</span> audioothers.mp3</h3>
<p>This file is an mp3 file recording the spoken audio. Presumably, based on its name, it only captures audio spoken by people who were not recording, but this has not been verified directly. This file only exists in streams in which someone was speaking. In order to create an audio track for the entire file, one needs to create a space for silence for the duration of each stream without this file.</p>
</section>
<section id="events.txt" class="level3" data-number="2.2.4">
<h3 data-number="2.2.4" class="anchored" data-anchor-id="events.txt"><span class="header-section-number">2.2.4</span> events.txt</h3>
<p>This file mainly deals with changes that aren’t necessarily tied to an avatar. It is also a JSON file despite its suffix. Much of the activity in this file is related to IFX motion and usage. Other than hints given by the names in the keys, it is not understood what these values refer to specifically.</p>
</section>
<section id="stream.txt" class="level3" data-number="2.2.5">
<h3 data-number="2.2.5" class="anchored" data-anchor-id="stream.txt"><span class="header-section-number">2.2.5</span> stream.txt</h3>
<p>This file is what appears to be a custom format storing the values of several variables for several users over a number of frames (140, in 2021). Breaking down each level from largest granularity to smallest:</p>
<p><strong>Users</strong> are demarcated by one or multiple leading <code>&gt;</code> characters. Each successive <code>&gt;</code> increments the user’s ID by one. For example, if users 1, 2, 5, and 6 are in the recording, then the <code>&gt;</code> characters will be distributed as follows: <code>&gt;</code> (1’s data) <code>&gt;</code> (2’s data) <code>&gt;&gt;&gt;</code> (5’s data) <code>&gt;</code> (6’s data). Note that at the point in the file with user data, the user ID is equal to the number of <code>&gt;</code>s that precede it in the entire file.</p>
<p><strong>Variables</strong> are demarcated with a name and one <code>|</code> character at the beginning, and one <code>;</code> character at the end. Variable names follow the format <code>&lt;name&gt;&lt;type&gt;x</code>. Here, <code>&lt;type&gt;</code> can be <code>int</code> for integer, <code>flo</code> for float, or <code>v3</code> for a 3D vector type.</p>
<p>The spatial variables we used had a <code>&lt;name&gt;</code> following the convention <code>&lt;tracked_point&gt;(Positions|Rotations)</code>. The tracked points included <code>AvaRoot</code>, <code>Head</code>, <code>LeftHand</code>, <code>RightHand</code>, <code>LeftFoot</code>, <code>RightFoot</code>, and <code>Hip</code>. For all the data collected in the summer and fall 2021 studies, the values for the feet and the hips were unused and not meaningful. <code>AvaRoot</code> stands for Avatar Root, and it defined the coordinate transformation from the coordinate space for <code>Head</code>, <code>LeftHand</code>, and <code>RightHand</code> into the global coordinate system.</p>
<p>The only other variable we used was <code>LipSyncAverageflox</code>, which indicated the amount of an avatar’s lip-flapping and was presumably based upon volume. There were several other values that are included in the recording but we have not used, such as <code>IFXScaleflox</code>, <code>(Left|Right)TriggerPressedintx</code>, <code>(Left|Right)HandPointingintx</code>, <code>(Left|Right)HandLaserPointerintx</code> <code>(Left|Right)HandWhiteboardingintx</code>, <code>TabletOutintx</code>, <code>AvatarEmotionStateintx</code>, <code>RaisingHandintx</code>, <code>Clappingintx</code>, <code>OutfitOverrideStateintx</code>, <code>UseSitTriggerOverridesintx</code> <code>IsAwayintx</code>, <code>IsInSitTriggerintx</code>, <code>(Left|Right)HandWhiteboardEmitterPositionsv3x</code>, <code>IfxPositionsv3x</code>, and <code>IfxRotationsv3x</code>.</p>
<p><strong>Samples</strong> are demarcated with with infixed <code>|</code>. Any values that are equal to the previous value are not included, so several variables often are written <code>|0|||||...</code>.</p>
<p><strong>3D Vectors</strong> are demarcated in a special way relative to other data types. The three elements of the vector are separated with infix <code>&lt;</code> symbols, and changes propagate along dimension individually. For example, the value <code>|&lt;2.345&lt;|</code> means the y-value changed to 2.345, but the x- and z- values remained the same. Position and rotation vectors were written the same way; they only difference in the data itself is the variable name discussed above. Positions are interpreted as <code>X&lt;Y&lt;Z</code>, where axis conventions are used according to Unity (Y up, Z out, left-handed). Rotations are interpreted as <code>pitch&lt;yaw&lt;roll</code>, where angle conventions are also used according to Unity.</p>
</section>
</section>
<section id="interpretations" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="interpretations"><span class="header-section-number">2.3</span> Interpretations</h2>
<section id="root-head-hands-physical-virtual-and-visible-motion" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="root-head-hands-physical-virtual-and-visible-motion"><span class="header-section-number">2.3.1</span> Root, Head, Hands / Physical, Virtual, and Visible Motion</h3>
<p>ENGAGE separates out motion into four related channels. <code>AvaRoot</code> stands for Avatar Root, and it defines the coordinate transformation from the coordinate space for <code>Head</code>, <code>LeftHand</code>, and <code>RightHand</code> into the global coordinate system. What is particularly nice about ENGAGE’s data being in this format is that one can distinguish between <em>physical</em>, <em>virtual</em>, and <em>visible</em> motion.</p>
<p>With virtual reality, what is <em>visible</em> to others in the virtual environment is a result of two kinds of motion: <em>physical</em> and <em>virtual</em> motion.</p>
<ul>
<li><strong>Physical</strong> motion is what it sounds like: it’s motion in the physical [real] world. Moving one’s real hand creates physical motion. Calculating the physical position and motion is just as easy as selecting just the <code>Head</code>, <code>LeftHand</code>, and <code>RightHand</code> columns.</li>
<li><strong>Virtual</strong> motion is motion that is caused by some process that doesn’t directly represent the motion. For example, teleporting is a kind of virtual motion, and so is pressing a button and moving in the virtual world. The thing that caused that motion wasn’t literally motion, it was something translated by the system. This is given by just the <code>AvaRoot</code> columns, because it’s the same in ENGAGE across all the three other tracked points.</li>
<li><strong>Visible</strong> motion is the motion that is (usually) the vector sum of these two types of motion. This is the way ENGAGE does it, at least. It is the motion with the virtual world as its framing. To calculate the visible position using <code>dddr</code> and <code>ungage</code>, take the example of this code:</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_tsv</span>(file_path, <span class="at">col_types =</span> <span class="fu">list</span>(<span class="at">Timestamp =</span> <span class="fu">col_time</span>(<span class="st">"%H:%M:%OS"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bundle</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Root =</span> <span class="st">"AvaRoot_Pos{v}"</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">RootRot =</span> <span class="st">"AvaRoot_Rot{ed}"</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">PhysicalHead =</span> <span class="st">"Head_Pos{v}"</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">PhysicalHeadRot =</span> <span class="st">"Head_Rot{ed}"</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Timestamp, Root, RootRot, PhysicalHead, PhysicalHeadRot) <span class="sc">%&gt;%</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert to visible motion</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">VisibleRawHead =</span> Root <span class="sc">+</span> <span class="fu">rotate</span>(PhysicalHead, RootRot),</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">VisibleRawHeadRot =</span> <span class="fu">rotate</span>(PhysicalHeadRot, RootRot, <span class="at">as =</span> <span class="st">"orientation"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>It should be noted this taxonomy is not complete. For example, it doesn’t allow for describing alternative methods of motion, such as redirected walking or visuo-haptic illusions. Nevertheless, it is a useful description of motion when working with ENGAGE.</p>
</section>
<section id="others" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="others"><span class="header-section-number">2.3.2</span> others…</h3>
<p>[[more could be written here — a good threshold for smooth motion is 3.05 m/s]]</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./dddr.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title"><code>dddr</code>: Three-Dimensional Vector Operations in R</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./bids.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">BIDS (Brain Imaging Data Structure)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>